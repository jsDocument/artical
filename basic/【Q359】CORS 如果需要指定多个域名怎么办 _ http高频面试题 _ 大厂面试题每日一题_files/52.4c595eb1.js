(window.webpackJsonp=window.webpackJsonp||[]).push([[52],{474:function(t,s,e){"use strict";e.r(s);var n=e(54),o=Object(n.a)({},(function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"csp-是干什么用的了"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#csp-是干什么用的了"}},[t._v("#")]),t._v(" CSP 是干什么用的了")]),t._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[t._v("Issue")]),t._v(" "),e("p",[t._v("欢迎在 Gtihub Issue 中回答此问题: "),e("a",{attrs:{href:"https://github.com/shfshanyue/Daily-Question/issues/269",target:"_blank",rel:"noopener noreferrer"}},[t._v("Issue 269"),e("OutboundLink")],1)])]),t._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[t._v("Author")]),t._v(" "),e("p",[t._v("回答者: "),e("a",{attrs:{href:"https://github.com/DoubleRayWang",target:"_blank",rel:"noopener noreferrer"}},[t._v("DoubleRayWang"),e("OutboundLink")],1)])]),t._v(" "),e("p",[t._v("http://www.ruanyifeng.com/blog/2016/09/csp.html")]),t._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[t._v("Author")]),t._v(" "),e("p",[t._v("回答者: "),e("a",{attrs:{href:"https://github.com/shfshanyue",target:"_blank",rel:"noopener noreferrer"}},[t._v("shfshanyue"),e("OutboundLink")],1)])]),t._v(" "),e("p",[e("code",[t._v("CSP")]),t._v(" "),e("strong",[t._v("只允许加载指定的脚本及样式")]),t._v("，"),e("strong",[t._v("最大限度地防止 "),e("code",[t._v("XSS")]),t._v(" 攻击")]),t._v("，是解决 XSS 的最优解。CSP 的设置根据加载页面时 http 的响应头 "),e("code",[t._v("Content Security Policy")]),t._v(" 在服务器端控制。")]),t._v(" "),e("ol",[e("li",[t._v("外部脚本可以通过指定域名来限制："),e("strong",[e("code",[t._v("Content-Security-Policy: script-src 'self'")])]),t._v("，"),e("code",[t._v("self")]),t._v(" 代表只加载当前域名")]),t._v(" "),e("li",[t._v("如果网站必须加载内联脚本 (inline script) ，则可以提供一个 "),e("code",[t._v("nonce")]),t._v(" 才能执行脚本，攻击者则无法注入脚本进行攻击。"),e("strong",[e("code",[t._v("Content-Security-Policy: script-src 'nonce-xxxxxxxxxxxxxxxxxx'")])])])]),t._v(" "),e("p",[t._v("通过 "),e("code",[t._v("devtools -> network")]),t._v(" 可见 github 的 CSP 配置如下：")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("Content-Security-Policy: default-src "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'none'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  base-uri "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'self'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  block-all-mixed-content"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  connect-src "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'self'")]),t._v(" uploads.github.com www.githubstatus.com collector.githubapp.com api.github.com www.google-analytics.com github-cloud.s3.amazonaws.com github-production-repository-file-5c1aeb.s3.amazonaws.com github-production-upload-manifest-file-7fdce7.s3.amazonaws.com github-production-user-asset-6210df.s3.amazonaws.com cdn.optimizely.com logx.optimizely.com/v1/events wss://alive.github.com"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  font-src github.githubassets.com"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  form-action "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'self'")]),t._v(" github.com gist.github.com"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  frame-ancestors "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'none'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  frame-src render.githubusercontent.com"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  img-src "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'self'")]),t._v(" data: github.githubassets.com identicons.github.com collector.githubapp.com github-cloud.s3.amazonaws.com *.githubusercontent.com"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  manifest-src "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'self'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  media-src "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'none'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  script-src github.githubassets.com"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  style-src "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'unsafe-inline'")]),t._v(" github.githubassets.com"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  worker-src github.com/socket-worker.js gist.github.com/socket-worker.js\n")])])]),e("h2",{attrs:{id:"相关链接"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#相关链接"}},[t._v("#")]),t._v(" 相关链接")]),t._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"http://www.ruanyifeng.com/blog/2016/09/csp.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Content Security Policy 入门教程 - 阮一峰"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("a",{attrs:{href:"https://www.w3.org/TR/CSP3/#directive-form-action",target:"_blank",rel:"noopener noreferrer"}},[t._v("Content Security Policy - w3"),e("OutboundLink")],1)])]),t._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[t._v("Author")]),t._v(" "),e("p",[t._v("回答者: "),e("a",{attrs:{href:"https://github.com/zzetao",target:"_blank",rel:"noopener noreferrer"}},[t._v("zzetao"),e("OutboundLink")],1)])]),t._v(" "),e("h3",{attrs:{id:"content-security-policy-csp"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#content-security-policy-csp"}},[t._v("#")]),t._v(" Content Security Policy (CSP)")]),t._v(" "),e("p",[e("strong",[t._v("介绍：")])]),t._v(" "),e("ol",[e("li",[t._v("解决 XSS 最优办法")]),t._v(" "),e("li",[t._v("可以设置信任域名才可以访问 script / audio / video / image ...")])]),t._v(" "),e("p",[e("strong",[t._v("防止 XSS 例子：")]),t._v("\n攻击者通过 恶意脚本(假设有执行外部脚本) 注入到系统内，显示给访问用户，以此来获取用户信息\n我们可以通过 CSP 来设置信任域名才可以执行 .js 脚本。")]),t._v(" "),e("p",[e("strong",[t._v("如何设置：")])]),t._v(" "),e("ol",[e("li",[t._v("HTTP 请求头")]),t._v(" "),e("li",[t._v("Meta 标签")])]),t._v(" "),e("p",[t._v("MDN：https://developer.mozilla.org/zh-CN/docs/Web/HTTP/CSP")]),t._v(" "),e("p",[t._v("兼容性：IE >= 10")])])}),[],!1,null,null,null);s.default=o.exports}}]);