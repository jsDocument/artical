(window.webpackJsonp=window.webpackJsonp||[]).push([[57],{479:function(t,e,s){"use strict";s.r(e);var a=s(54),n=Object(a.a)({},(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"如何避免-cdn-为-pc-端缓存移动端页面"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#如何避免-cdn-为-pc-端缓存移动端页面"}},[t._v("#")]),t._v(" 如何避免 CDN 为 PC 端缓存移动端页面")]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("Issue")]),t._v(" "),s("p",[t._v("欢迎在 Gtihub Issue 中回答此问题: "),s("a",{attrs:{href:"https://github.com/shfshanyue/Daily-Question/issues/330",target:"_blank",rel:"noopener noreferrer"}},[t._v("Issue 330"),s("OutboundLink")],1)])]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("Author")]),t._v(" "),s("p",[t._v("回答者: "),s("a",{attrs:{href:"https://github.com/shfshanyue",target:"_blank",rel:"noopener noreferrer"}},[t._v("shfshanyue"),s("OutboundLink")],1)])]),t._v(" "),s("p",[t._v("如果 PC 端和移动端是一套代码则不会出现这个问题。"),s("strong",[t._v("这个问题出现在 PC 端和移动端是两套代码，却共用一个域名。")])]),t._v(" "),s("p",[t._v("使用 "),s("code",[t._v("nginx")]),t._v(" 配置如下，根据 UA 判断是否移动端，而走不同的逻辑 (判断 UA 是否移动端容易出问题)")]),t._v(" "),s("div",{staticClass:"language-conf extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('location / {\n    // 默认 PC 端\n    root /usr/local/website/web;\n\n    # 判断 UA，访问移动端\n    if ( $http_user_agent ~* "(Android|webOS|iPhone|iPad|BlackBerry)" ){\n        root /usr/local/website/mobile;\n    }\n\n    index index.html index.htm;\n}\n')])])]),s("p",[t._v("解决方案通常使用 "),s("code",[t._v("Vary")]),t._v(" 响应头，来控制 CDN 对不同请求头的缓存。")]),t._v(" "),s("p",[s("strong",[t._v("此处可以使用 "),s("code",[t._v("Vary: User-Agent")]),t._v(" ，代表如果 User-Agent 不一样，则重新发起请求，而非从缓存中读取页面")])]),t._v(" "),s("div",{staticClass:"language-txt extra-class"},[s("pre",{pre:!0,attrs:{class:"language-txt"}},[s("code",[t._v("Vary: User-Agent\n")])])]),s("p",[t._v("当然，"),s("code",[t._v("User-Agent")]),t._v(" 实在过多，此时缓存失效就会过多。")]),t._v(" "),s("h2",{attrs:{id:"简答"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#简答"}},[t._v("#")]),t._v(" 简答")]),t._v(" "),s("p",[t._v("使用 "),s("code",[t._v("Vary: User-Agent")]),t._v("，根据 UA 进行缓存。")]),t._v(" "),s("div",{staticClass:"language-txt extra-class"},[s("pre",{pre:!0,attrs:{class:"language-txt"}},[s("code",[t._v("Vary: User-Agent\n")])])]),s("p",[t._v("但最好不要出现这种情况，PC 端和移动端如果是两套代码，建议用两个域名，理由如下")]),t._v(" "),s("ol",[s("li",[s("code",[t._v("nginx")]),t._v(" 判断是否移动端容易出错")]),t._v(" "),s("li",[t._v("对缓存不友好")])])])}),[],!1,null,null,null);e.default=n.exports}}]);