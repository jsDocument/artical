(window.webpackJsonp=window.webpackJsonp||[]).push([[88],{261:function(t,s,a){"use strict";a.r(s);var n=a(0),e=Object(n.a)({},(function(){var t=this.$createElement;this._self._c;return this._m(0)}),[function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"content"},[a("h1",{attrs:{id:"mongoodb"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mongoodb"}},[t._v("#")]),t._v(" mongoodb")]),t._v(" "),a("h2",{attrs:{id:"mongodb-默认数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mongodb-默认数据"}},[t._v("#")]),t._v(" mongodb 默认数据")]),t._v(" "),a("ol",[a("li",[t._v("local 库：副本集的元数据")]),t._v(" "),a("li",[t._v("admin 库：用户和角色信息")])]),t._v(" "),a("ul",[a("li",[t._v("system.users")]),t._v(" "),a("li",[t._v("system.roles")])]),t._v(" "),a("h2",{attrs:{id:"mongod-进行数据库设置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mongod-进行数据库设置"}},[t._v("#")]),t._v(" mongod 进行数据库设置")]),t._v(" "),a("ul",[a("li",[t._v("mongoDB服务")])]),t._v(" "),a("ol",[a("li",[t._v("启动 net start MongoDB  / brew services start mongodb")]),t._v(" "),a("li",[t._v("关闭 net stop MongoDB   / brew services stop mongodb 或 db.shutdownServer()")]),t._v(" "),a("li",[t._v("移除 mongod --remove")])]),t._v(" "),a("ul",[a("li",[t._v("设置并启动命令")])]),t._v(" "),a("ol",[a("li",[t._v("命令设置")]),t._v(" "),a("li",[t._v("配置文件设置")])]),t._v(" "),a("ul",[a("li",[t._v("文件地址：/Users/mengyue/yue/Downloads/mongdb_data/mongodb.conf")]),t._v(" "),a("li",[t._v("启动并查看进程：mongod --config & netstat -nltp|grep 接口")]),t._v(" "),a("li",[t._v("mongod --config & mongo 或 mongod --config ./mongodb.conf & mongo -u 'admin' -p 'xiaohan'")]),t._v(" "),a("li",[t._v("查看mongod设置")])]),t._v(" "),a("h2",{attrs:{id:"mongo-连接数据库并打开shell窗口"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mongo-连接数据库并打开shell窗口"}},[t._v("#")]),t._v(" mongo 连接数据库并打开shell窗口")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("某用户登录连接 mongo -u 'name' -p 'pwd'")])]),t._v(" "),a("li",[a("p",[t._v("常用参数")])])]),t._v(" "),a("ol",[a("li",[t._v("nodb 不连接数据库，进入sell命令行")]),t._v(" "),a("li",[t._v("ssl ssl连接")]),t._v(" "),a("li",[t._v("shell 执行shell文件")])]),t._v(" "),a("h2",{attrs:{id:"用户管理与查看"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#用户管理与查看"}},[t._v("#")]),t._v(" 用户管理与查看")]),t._v(" "),a("ul",[a("li",[t._v("MongoDB是没有默认管理员账号，所以要先添加管理员账号，再开启权限认证。")]),t._v(" "),a("li",[t._v("切换到admin数据库，添加的账号才是管理员账号。")]),t._v(" "),a("li",[t._v("用户只能在用户所在数据库登录，包括管理员账号。")]),t._v(" "),a("li",[t._v("管理员可以管理所有数据库，但是不能直接管理其他数据库，要先在admin数据库认证后才可以。")])]),t._v(" "),a("ol",[a("li",[t._v("进入admin 创建用户")])]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("db"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("createUser")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("user")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'name'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("pwd")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("roles")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("role")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"userAdminAnyDatabase"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("db")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"admin"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 超级用户：")]),t._v("\ndb"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("createUser")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("user")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'root'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("pwd")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'xiaohan'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("roles")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'root'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ndb"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("createUser")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("user")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"user001"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("pwd")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"123456"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("customData")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'jim'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("email")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'jim@qq.com'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("age")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("18")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("roles")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("role")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"readWrite"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("db")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"db001"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("role")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"readWrite"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("db")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"db002"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'read'")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 对其他数据库有只读权限，对db001、db002是读写权限")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br")])]),a("ol",[a("li",[a("p",[t._v("开启权限验证\nmongo --auth 或 配置文件里添加 auth=true")])]),t._v(" "),a("li",[a("p",[t._v("db.auth('name','pwd') 验证权限是否生效")])]),t._v(" "),a("li",[a("p",[t._v('show users 或 db.runCommand({usersInfo:"userName"}) 或 db.system.users.find() 或 db.getUsers() 查看所有用户')])]),t._v(" "),a("li",[a("p",[t._v("db.addUserr('name','pwd', true) 只读")])]),t._v(" "),a("li",[a("p",[t._v("db.auth('name','pwd') 更改登录用户")])]),t._v(" "),a("li",[a("p",[t._v("db.removeUser('name')")])]),t._v(" "),a("li",[a("p",[t._v("db.runCommand({connectionStatus: 1}) 显示已认证用户")])]),t._v(" "),a("li",[a("p",[t._v("db.changeUserPassword('name', 'pwd') 或 db.runCommand({updateUser: 'name', pwd: '', customData: {}}) 修改用户名或密码")])]),t._v(" "),a("li",[a("p",[t._v("db.dropUser('name') 删除")])])]),t._v(" "),a("ul",[a("li",[a("p",[t._v("角色")]),t._v(" "),a("ol",[a("li",[t._v("数据库用户角色：read、readWrite；")]),t._v(" "),a("li",[t._v("数据库管理角色：dbAdmin、dbOwner、userAdmin;")]),t._v(" "),a("li",[t._v("集群管理角色：clusterAdmin、clusterManager、4. clusterMonitor、hostManage；")]),t._v(" "),a("li",[t._v("备份恢复角色：backup、restore；")]),t._v(" "),a("li",[t._v("所有数据库角色：readAnyDatabase、readWriteAnyDatabase、userAdminAnyDatabase、dbAdminAnyDatabase")]),t._v(" "),a("li",[t._v("超级用户角色：root")]),t._v(" "),a("li",[t._v("内部角色：__system")])])]),t._v(" "),a("li",[a("p",[t._v("权限")]),t._v(" "),a("ol",[a("li",[t._v("Read：允许用户读取指定数据库")]),t._v(" "),a("li",[t._v("readWrite：允许用户读写指定数据库")]),t._v(" "),a("li",[t._v("dbAdmin：允许用户在指定数据库中执行管理函数，如索引创建、删除，查看统计或访问system.profile")]),t._v(" "),a("li",[t._v("userAdmin：允许用户向system.users集合写入，可以在指定数据库里创建、删除和管理用户")]),t._v(" "),a("li",[t._v("clusterAdmin：只在admin数据库中可用，赋予用户所有分片和复制集相关函数的管理权限。")]),t._v(" "),a("li",[t._v("readAnyDatabase：只在admin数据库中可用，赋予用户所有数据库的读权限")]),t._v(" "),a("li",[t._v("readWriteAnyDatabase：只在admin数据库中可用，赋予用户所有数据库的读写权限")]),t._v(" "),a("li",[t._v("userAdminAnyDatabase：只在admin数据库中可用，赋予用户所有数据库的userAdmin权限")]),t._v(" "),a("li",[t._v("dbAdminAnyDatabase：只在admin数据库中可用，赋予用户所有数据库的dbAdmin权限。")]),t._v(" "),a("li",[t._v("root：只在admin数据库中可用。超级账号，超级权限")])])])]),t._v(" "),a("h2",{attrs:{id:"数据库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数据库"}},[t._v("#")]),t._v(" 数据库")]),t._v(" "),a("ol",[a("li",[t._v("show dbs;")]),t._v(" "),a("li",[t._v("use dbName 创建并切换，更多设置如何完成？")]),t._v(" "),a("li",[t._v("db.getName()")]),t._v(" "),a("li",[t._v("db.stats()")]),t._v(" "),a("li",[t._v("db.getMongo() 链接机器地址")]),t._v(" "),a("li",[t._v("db.repairDatabase()")]),t._v(" "),a("li",[t._v("db.copyDatabase('dbName','toDbName', 'ip')")]),t._v(" "),a("li",[t._v("db.cloneDatabase('ip')")]),t._v(" "),a("li",[t._v("db.dropDatabase()")])]),t._v(" "),a("h2",{attrs:{id:"集合"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#集合"}},[t._v("#")]),t._v(" 集合")]),t._v(" "),a("ol",[a("li",[t._v("show.collections")]),t._v(" "),a("li",[t._v("db.createCollection('colName', {limit})")]),t._v(" "),a("li",[t._v("db.getCollection('colName')")]),t._v(" "),a("li",[t._v("db.getCollectionNames();")]),t._v(" "),a("li",[t._v("db.col.find()")]),t._v(" "),a("li",[t._v("db.col.distinct('name') 去掉聚合中重复的数据")]),t._v(" "),a("li",[t._v("如何添加字段、限制与验证")]),t._v(" "),a("li",[t._v("修改集合名称")]),t._v(" "),a("li",[t._v("db.collectionName.drop() 删除集合")]),t._v(" "),a("li",[t._v("db.collectionName.remove() 移除集合中的所有文档")]),t._v(" "),a("li",[t._v("db.printCollectionStats()")])]),t._v(" "),a("h2",{attrs:{id:"条件关键字"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#条件关键字"}},[t._v("#")]),t._v(" 条件关键字")]),t._v(" "),a("ol",[a("li",[t._v("比较运算：$lt 小于  $lte    $gt    $gte    $ne不等于")]),t._v(" "),a("li",[t._v("$in 在集合内   $nin")]),t._v(" "),a("li",[t._v('布尔运算：$or, {"$or": []}     $not   $and')]),t._v(" "),a("li",[t._v("$mod")]),t._v(" "),a("li",[t._v("$null")]),t._v(" "),a("li",[t._v('$size (key: {"$size": 3})')]),t._v(" "),a("li",[t._v('$all (key: {"$all": []})')]),t._v(" "),a("li",[t._v('$slice  (key: {"$slice": n})  返回指定集合的个数，10：前10条，-10：后10条')]),t._v(" "),a("li",[t._v('$where {"$where": function(){}}  "this.age>18"')]),t._v(" "),a("li",[t._v("$exists {key: {$exists: true}}")]),t._v(" "),a("li",[t._v("$type {key: {$type: 2}}")]),t._v(" "),a("li",[t._v("正则 {key: /reg/}")])]),t._v(" "),a("h2",{attrs:{id:"操作关键字"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#操作关键字"}},[t._v("#")]),t._v(" 操作关键字")]),t._v(" "),a("ol",[a("li",[t._v("$set 修改或创建指定的文档[集]")]),t._v(" "),a("li",[t._v("$unset 移除指定文档属性，赋值为1, -1没有限制，都可将其删除-----不是字段，只是一个值")]),t._v(" "),a("li",[t._v("$inc 自增/减")]),t._v(" "),a("li",[t._v("$push 创建或更新数组结构")]),t._v(" "),a("li",[t._v('$push 与 $each 批量更新 {"$push": {"key": {"$each": []}}}')]),t._v(" "),a("li",[t._v("$addToSet 更新但不重复添加，只对数组操作")]),t._v(" "),a("li",[t._v('$pop {"$pop": {key: 1}} 1从末尾删除，-1从头部删除')]),t._v(" "),a("li",[t._v('$pull 删除数组指定元素 {"$pull": {"key": "value"}} 批量删除？')]),t._v(" "),a("li",[t._v("复合数据访问：key.subKey")]),t._v(" "),a("li",[t._v("数组字段访问：$elemMatch  数组字段中匹配其中某个元素， key.$.subKey 数组项下的field，key.$数组项")]),t._v(" "),a("li",[t._v("日期：new Date(2010,11,31)")])]),t._v(" "),a("h2",{attrs:{id:"查询"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查询"}},[t._v("#")]),t._v(" 查询")]),t._v(" "),a("ol",[a("li",[t._v('db.col.find("this.key > value",{key: 0/1, key: false/true 返回字段与否})')]),t._v(" "),a("li",[t._v("f = function(){ return this.key > value} db.col.find(f)")]),t._v(" "),a("li",[t._v("db.col.find({key: {$gt: value}})")]),t._v(" "),a("li",[t._v("db.col.find({key: /reg/})")])]),t._v(" "),a("h2",{attrs:{id:"更新"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#更新"}},[t._v("#")]),t._v(" 更新")]),t._v(" "),a("p",[t._v("db.collectionName.insert() 批量插入\ndb.collectionName.update({条件},{需更字段操作},更新或创建, 是否多条更新)")]),t._v(" "),a("h2",{attrs:{id:"分组"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#分组"}},[t._v("#")]),t._v(" 分组")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("db"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("col"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("cond")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("key")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("initial")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("reduce")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("finalize")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ndb"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("col"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("count")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ndb"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("col"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("distinct")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br")])]),a("h2",{attrs:{id:"联表"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#联表"}},[t._v("#")]),t._v(" 联表")]),t._v(" "),a("h2",{attrs:{id:"聚合-stage，当前stage计算结果会作为下一个stage的输入"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#聚合-stage，当前stage计算结果会作为下一个stage的输入"}},[t._v("#")]),t._v(" 聚合 stage，当前stage计算结果会作为下一个stage的输入")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("db"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("col"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("aggregate")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("$unwind")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"$key"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 将数组拆解成多个document, 字段必须指定")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("$group")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"_id"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"$key"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("outKey")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"$key"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("outKey")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("$sum")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"$key"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("$addToSet")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'$key'")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 将每个分组的该字段，写到一个数组中}}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('// $key为引用字段，指定分组的字段，对分组再次分组 {$group: {outKey: "$outKey.key"}}')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("$match")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"key"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("condition"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("$sort")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("key")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("$project")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("outKey")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"$key"')]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("outKey")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("outKey")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'$key'")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//格式化结果，_id默认包含，0/false不包含，1/true包含，如果字段结果值与的确为false...，用$literal")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("$redact")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("$cond")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("$gt")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("$size"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("$setIntersection")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"$key"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("then")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"$$DESCEND"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"$$PRUNE"')]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 对结果进行裁剪")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("$out")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("\\"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("collection"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 必须在最后，将计算结果定入到指定表，不存在的collection时，直接创建，存在则进行原子性替换(不改变原数据与索引)，出错时数据朱会改变")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("explain")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v(" 查看各个阶段执行的计划\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br"),a("span",{staticClass:"line-number"},[t._v("24")]),a("br"),a("span",{staticClass:"line-number"},[t._v("25")]),a("br"),a("span",{staticClass:"line-number"},[t._v("26")]),a("br"),a("span",{staticClass:"line-number"},[t._v("27")]),a("br"),a("span",{staticClass:"line-number"},[t._v("28")]),a("br"),a("span",{staticClass:"line-number"},[t._v("29")]),a("br"),a("span",{staticClass:"line-number"},[t._v("30")]),a("br"),a("span",{staticClass:"line-number"},[t._v("31")]),a("br"),a("span",{staticClass:"line-number"},[t._v("32")]),a("br"),a("span",{staticClass:"line-number"},[t._v("33")]),a("br"),a("span",{staticClass:"line-number"},[t._v("34")]),a("br"),a("span",{staticClass:"line-number"},[t._v("35")]),a("br"),a("span",{staticClass:"line-number"},[t._v("36")]),a("br"),a("span",{staticClass:"line-number"},[t._v("37")]),a("br"),a("span",{staticClass:"line-number"},[t._v("38")]),a("br")])]),a("p",[t._v(": 可以将结果输出到collection 或 内存并返回cursor，但返回结果不得超过16M，索引只会在访问原始document时有效，是pipeline中间数据，如$group后的$sort无法使用索引，可以尽量将$match, $limit, $skip放在开端，$group, $unwind, $project, $out尽量放在后面")]),t._v(" "),a("ol",[a("li",[t._v("$$DESCEND 当前document级别的所有field，当前级别字段的内嵌文档会被继续检测")]),t._v(" "),a("li",[t._v("$$PRUNE  不包含当前文档或内嵌文档级别的所有字段，不再继续检测此级别折其他字段，即使这些字段的内嵌文档中持有不同的访问级别")]),t._v(" "),a("li",[t._v("$$KEEP 包含当前文档和内嵌文档级别的所有字段，不再继续检测此级别折其他字段，即使这些字段的内嵌文档中持有不同的访问级别")])]),t._v(" "),a("ul",[a("li",[t._v("$group: {_id: <group key>, <field>}")])]),t._v(" "),a("ol",[a("li",[t._v("$push")]),t._v(" "),a("li",[t._v("$addToSet 表达式值添加到一个集合中(无重复值)")]),t._v(" "),a("li",[t._v("$multiply")]),t._v(" "),a("li",[t._v("$sum, $avg")]),t._v(" "),a("li",[t._v("$max, $min")]),t._v(" "),a("li",[t._v("$last, $first")]),t._v(" "),a("li",[t._v("$geoNear 地理位置数据分析")]),t._v(" "),a("li",[t._v("$sample: {\nsize: N\n} // 数据采样，随机N条数据")]),t._v(" "),a("li",[t._v("$lookup: {\nfrom: 参与join的辅表,\nlocalField: 参与join匹配的本表字段\nforeignField: 参与join匹配的辅表字段\nas: 将辅表输出到些字段中\n}// 联表，当前表为主表，另一个作为辅表")])]),t._v(" "),a("ul",[a("li",[t._v("条件")])]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("$cond")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" boolean"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("then")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" exp\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" exp\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2.")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("$ifNull")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" boolean"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("then")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" exp\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" exp\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br")])]),a("ul",[a("li",[t._v("$redact")])]),t._v(" "),a("ol",[a("li",[t._v("$cond 三元表达式")]),t._v(" "),a("li",[t._v("$setIntersection 表示两个数组的交集中不同元素的个数")]),t._v(" "),a("li",[t._v("$$DESCEND")]),t._v(" "),a("li",[t._v("$$PRUNE")])]),t._v(" "),a("ul",[a("li",[t._v("自定义变量")])]),t._v(" "),a("ol",[a("li",[a("p",[t._v("$let: {vars: {outVar: exp }, in: {exp} }")])]),t._v(" "),a("li",[a("p",[t._v("$map: {input: exp, as: item, in: exp}  //数组进行迭代，返回一个新数组")])])]),t._v(" "),a("p",[t._v(": vars 临时变量，in 用来计算，访问vars变量需要用$$前缀，只能在此访问\n: input 需要计算的数组，as当前数组元素的别名，in 可以使用当前元素别名进行计算")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("$literal 只做字符串原样输出")])]),t._v(" "),a("li",[a("p",[t._v("集合操作， 多个数组比较")])])]),t._v(" "),a("ol",[a("li",[t._v("$setEquals")]),t._v(" "),a("li",[t._v("$setInterSection 多个数组的交集")]),t._v(" "),a("li",[t._v("$setUnion 并集")]),t._v(" "),a("li",[t._v("$setDifference 两个数组的差集")]),t._v(" "),a("li",[t._v("$setIsSubSet 第一个是否为第二个的子集")]),t._v(" "),a("li",[t._v("$anyElementsTrue 一个数组中有一个为true，即结果为true")]),t._v(" "),a("li",[t._v("$allElementsTrue")])]),t._v(" "),a("ul",[a("li",[t._v("数学计算")])]),t._v(" "),a("ol",[a("li",[t._v("$add")]),t._v(" "),a("li",[t._v("$subtract")]),t._v(" "),a("li",[t._v("$multiply")]),t._v(" "),a("li",[t._v("$divide")]),t._v(" "),a("li",[t._v("$mod")])]),t._v(" "),a("ul",[a("li",[t._v("字符串操作")])]),t._v(" "),a("ol",[a("li",[t._v("$concat: []")]),t._v(" "),a("li",[t._v("$substr: [input, start, length]")]),t._v(" "),a("li",[t._v("$toLower, $toUper")]),t._v(" "),a("li",[t._v("$strrcasecmp  比较")]),t._v(" "),a("li",[t._v("$size 大小")])]),t._v(" "),a("ul",[a("li",[t._v("日期")])]),t._v(" "),a("ol",[a("li",[t._v("$dayOfYear 此年的第几天")]),t._v(" "),a("li",[t._v("$dayOfMonth 本月第几天")]),t._v(" "),a("li",[t._v("$dayOfWeek 本周第几天，1表示周日")]),t._v(" "),a("li",[t._v("$year 当前年份")]),t._v(" "),a("li",[t._v("$week 当年第几周")]),t._v(" "),a("li",[t._v("$month")]),t._v(" "),a("li",[t._v("$hour")]),t._v(" "),a("li",[t._v("$minute")]),t._v(" "),a("li",[t._v("$second")]),t._v(" "),a("li",[t._v("$millisecond")]),t._v(" "),a("li",[t._v('$dateToString: {format: <format>, date: "$date"}')])]),t._v(" "),a("p",[t._v(": %Y, %m, %d, %H, %M, %S, %L, %j年的第几天, %U 第几周, %w 当前周的第几天、")]),t._v(" "),a("ul",[a("li",[t._v('db.col.mapReduce(function(){ map函数, this当前文档， emit函数将数据传给reduce函数 }, function(key, values){ reduce函数，map的输出做为该函数输入}, {out: "保存到col"})')])]),t._v(" "),a("h2",{attrs:{id:"其他"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#其他"}},[t._v("#")]),t._v(" 其他")]),t._v(" "),a("p",[t._v("db.runCommand({getLastError: 1}) 上一条执行结果")]),t._v(" "),a("h2",{attrs:{id:"索引"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#索引"}},[t._v("#")]),t._v(" 索引")]),t._v(" "),a("p",[t._v("db.collectionName.ensureIndex({key: 1, key: -1}, {unique: true, dropDups: true})\ndb.collectionName.getIndexes()\ndb.collectionName.getIndexKeys()")]),t._v(" "),a("h2",{attrs:{id:"其他方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#其他方法"}},[t._v("#")]),t._v(" 其他方法")]),t._v(" "),a("ol",[a("li",[t._v("sort({age: 1})")]),t._v(" "),a("li",[t._v("limit()")]),t._v(" "),a("li",[t._v("count()")]),t._v(" "),a("li",[t._v("distinct()")]),t._v(" "),a("li",[t._v("db.col.dataSize()")]),t._v(" "),a("li",[t._v("db.col.stats()")]),t._v(" "),a("li",[t._v("db.col.totalIndexSize()")]),t._v(" "),a("li",[t._v("skip()")])])])}],!1,null,null,null);s.default=e.exports}}]);